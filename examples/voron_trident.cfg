#####################################################################
##                    LUMEN Configuration
##
##  LED control for Klipper printers via Moonraker component.
##  
##  This file is read by the LUMEN Moonraker component, NOT Klipper.
##  After changes, restart Moonraker: sudo systemctl restart moonraker
##  Or use hot reload: curl -X POST http://localhost:7125/server/lumen/reload
##
##  Hardware definitions ([neopixel], [output_pin]) go in printer.cfg
##  or the appropriate board config (ebb42.cfg, etc.)
#####################################################################


#####################################################################
##                                                                 ##
##                    GLOBAL SETTINGS                              ##
##                                                                 ##
#####################################################################

[lumen_settings]
max_brightness: 0.4        # Global brightness cap (0.0-1.0)
temp_floor: 20             # Ambient temp baseline (Â°C)
bored_timeout: 30          # Seconds idle before "bored"
sleep_timeout: 60          # Seconds bored before "sleep"
# Klipper driver (SET_LED) - affects G-code queue
update_rate: 0.1           # Seconds between effect updates (10 Hz)
update_rate_printing: 5.0  # Slower during prints (Klipper queue busy)
# GPIO driver (rpi_ws281x) - Pi CPU only, no Klipper impact
gpio_fps: 60               # Frames per second (30 = smooth, 10 = Pi Zero safe)
# Bed dimensions for tracking modes
bed_x_min: 0               # Minimum X position (mm)
bed_x_max: 350             # Maximum X position (mm)
bed_y_min: 0               # Minimum Y position (mm)
bed_y_max: 350             # Maximum Y position (mm)

#####################################################################
##                                                                 ##
##                    EFFECT SETTINGS                              ##
##                    (Tune how effects behave)                    ##
##                                                                 ##
#####################################################################

[lumen_effect pulse]
speed: 1.0                 # Cycles per second (1.0 = 1 sec breathe, 0.5 = 2 sec)
min_brightness: 0.2        # Dimmest point (0.0-1.0)
max_brightness: 0.6        # Brightest point (0.0-1.0)

[lumen_effect heartbeat]
speed: 1.2                 # Beats per second (1.2 = 72 BPM, resting heart rate)
min_brightness: 0.1
max_brightness: .6

[lumen_effect disco]
speed: 3.0                 # Color changes per second (higher = more chaotic)
min_sparkle: 1             # Minimum LEDs to light per update
max_sparkle: 6             # Maximum LEDs to light per update
max_brightness: 0.6

[lumen_effect thermal]
temp_source: extruder      # extruder | bed | chamber
start_color: ice           # Cold color (at temp_floor)
end_color: lava            # Hot color (at target temp)
gradient_curve: 2.0        # 1.0=linear, >1=sharp at end, <1=sharp at start

[lumen_effect progress]
start_color: steel         # Color at 0% progress
end_color: matrix          # Color at 100% progress
gradient_curve: 1.5        # Slightly sharper at end

[lumen_effect rainbow]
speed: 0.5                 # Cycles per second (0.5 = 2 seconds per full rainbow)
rainbow_spread: 1.0        # How much rainbow spreads across strip (0.0-1.0)
max_brightness: 0.9

[lumen_effect fire]
speed: 5.0                 # Flicker updates per second (higher = more chaotic)
min_brightness: 0.1        # Dimmest flame
max_brightness: 0.6        # Brightest flame
fire_cooling: 0.4          # Cooling rate (0.0-1.0, higher = more chaotic)

[lumen_effect comet]
speed: 10.0                # Movement speed (LEDs per second)
max_brightness: 0.5        # Brightness of comet head
comet_tail_length: 4       # Length of trailing tail (in LEDs)
comet_fade_rate: 0.9       # How quickly tail fades (0.0-1.0)

[lumen_effect chase]
speed: 50.0                      # Movement speed (LEDs per second)
chase_size: 2                    # LEDs per segment
chase_color_1: lava              # First segment color (predator)
chase_color_2: ice               # Second segment color (prey)
chase_offset_base: 0.5           # Base distance between segments (0.0-1.0, single-group only)
chase_offset_variation: 0.1      # How much offset varies (single-group only)
chase_proximity_threshold: 0.15  # 15% of ring = "getting close" (multi-group)
chase_accel_factor: 1.5          # Speed boost when hunting/fleeing (multi-group)
chase_role_swap_interval: 20     # Avg seconds between role swaps (multi-group)
chase_collision_pause: 0.3       # Seconds to pause after collision (multi-group)
max_brightness: .6

[lumen_effect kitt]
speed: .8                  # Bounce speed (sweeps per second)
base_color: red            # Scanner color (classic red!)
kitt_eye_size: 3           # LEDs in bright center eye
kitt_tail_length: 2        # Fading LEDs on each side
kitt_tracking_axis: none      # "none" | "x" | "y" (for bed mesh tracking)
max_brightness: .6



# #####################################################################
# ##                                                                 ##
# ##                    LED GROUPS - PROXY DRIVER                    ##
# ##                    (RPi GPIO via ws281x proxy)                  ##
# ##                                                                 ##
# ##  Use this driver for WS2812B/NeoPixel strips connected directly ##
# ##  to Raspberry Pi GPIO pins. Requires ws281x-proxy service.      ##
# ##                                                                 ##
# ##  Supported GPIO: 18(PWM0), 13(PWM1), 12(PWM0) 19(PWM1) 21(PWM1) ##
# ##                                                                 ##
# #####################################################################



[lumen_group right]
driver: proxy
gpio_pin: 18
proxy_host: 127.0.0.1
proxy_port: 3769
index_start: 1
index_end: 18
color_order: GRB
direction: standard
on_idle: solid white
on_heating: thermal extruder ice lava 2.0 # Inline: source start end curve
on_printing: solid white
on_cooldown: chase 3
on_error: heartbeat red
on_bored: disco
on_sleep: off

[lumen_group left]
driver: proxy
gpio_pin: 18
proxy_host: 127.0.0.1
proxy_port: 3769
index_start: 19
index_end: 36
color_order: GRB
direction: reverse
on_idle: solid white
on_heating: thermal bed ice fire 1.0 # Inline: source start end curve
on_printing: solid white
on_cooldown: chase 1 
on_error: heartbeat red
on_bored: disco
on_sleep: off

[lumen_group center]
driver: proxy
gpio_pin: 18
proxy_host: 127.0.0.1
proxy_port: 3769
index_start: 37
index_end: 53
color_order: GRB
direction: reverse
on_idle: kitt cobalt
on_heating: fire
on_printing: progress steel matrix 1.5   # Inline: start end curve
on_cooldown: chase 2
on_error: heartbeat red
on_bored: disco
on_sleep: off



# ###################################################################
#                                                                 ##
#                    LED GROUPS - KLIPPER DRIVER                  ##
#                    (MCU-connected via SET_LED)                  ##
#                                                                 ##
#  Use this driver for LEDs defined in Klipper config as          ##
#  [neopixel] or [led] sections. Works with all MCUs.             ##
#                                                                 ##
#  Note: Effects are slower during prints due to G-code queue.    ##
#                                                                 ##
# ###################################################################

[lumen_group toolhead_emblem]
driver: klipper            # Uses Klipper's SET_LED command
neopixel: toolhead_leds    # Must match [neopixel XXX] in printer.cfg
index_start: 1
index_end: 1
direction: standard
on_idle: pulse cobalt
on_heating: solid cobalt
on_printing: solid cobalt
on_cooldown: solid cobalt
on_error: solid red
on_bored: disco
on_sleep: off


[lumen_group toolhead_worklights]
driver: klipper
neopixel: toolhead_leds   # Same neopixel, different LED range
index_start: 2
index_end: 3
direction: standard
on_idle: off
on_heating: solid white
on_printing: solid white
on_cooldown: solid ice
on_error: solid red
on_bored: disco
on_sleep: off



#####################################################################
##                                                                 ##
##                    LED GROUPS - PWM DRIVER                      ##
##                    (Single-color via SET_PIN)                   ##
##                                                                 ##
##  Use this driver for single-color LED strips controlled via     ##
##  PWM output pins defined in Klipper config.                     ##
##                                                                 ##
#####################################################################

# [lumen_group caselight]
# driver: pwm              # Uses Klipper's SET_PIN command
# pin_name: caselight     # Must match [output_pin XXX] in printer.cfg
# on_idle: dim
# on_heating: dim
# on_printing: on
# on_cooldown: dim
# on_error: off
# on_bored: off
# on_sleep: off


#####################################################################
##                                                                 ##
##                    QUICK REFERENCE                              ##
##                                                                 ##
#####################################################################
##
##  EFFECTS:
##    solid <color>             - Static color
##    pulse <color>             - Breathing/fade effect
##    heartbeat <color>         - Pulsing like a heartbeat
##    disco                     - Random sparkles
##    thermal <src> <c1> <c2> <curve>  - Temperature gradient
##    progress <c1> <c2> <curve>       - Print progress gradient
##    rainbow                   - Animated rainbow cycle
##    fire                      - Flickering fire effect
##    comet <color>             - Shooting comet with tail
##    chase <group_num>         - Predator/prey chase (use chase 1, chase 2, etc. for multi-group)
##    kitt <color>              - KITT scanner bounce effect
##    off                       - LEDs off
##
##  COLORS (50+ named colors available):
##    Use: curl http://localhost:7125/server/lumen/colors
##    
##    Common: white, black, red, green, blue, yellow, orange, purple
##    Cool:   ice, cobalt, azure, teal, mint, cyan
##    Warm:   lava, fire, gold, amber, coral, salmon
##    Accent: matrix, neon_pink, neon_green, steel
##
##  COLOR ORDER (for proxy/gpio drivers):
##    GRB  - Most WS2812B strips (default)
##    RGB  - Some WS2811 strips
##    BRG  - Some SK6812 strips
##    BGR, RBG, GBR - Less common variants
##
##  API ENDPOINTS:
##    GET  /server/lumen/status     - Current state and LED info
##    GET  /server/lumen/colors     - List all named colors
##    POST /server/lumen/reload     - Hot reload configuration
##    POST /server/lumen/test_event?event=<state>  - Test a state
##
#####################################################################
