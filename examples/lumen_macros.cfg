# LUMEN Macro Examples
#
# Add these to your printer.cfg to enable convenient LUMEN control via macros.
# These macros use the LUMEN API endpoints for testing and control.

[gcode_macro LUMEN_RELOAD]
description: Reload LUMEN configuration without restarting Moonraker
gcode:
    {action_call_remote_method("POST",
                               uri="/server/lumen/reload")}
    RESPOND MSG="LUMEN configuration reloaded"

[gcode_macro LUMEN_TEST]
description: Test a specific printer state (e.g., LUMEN_TEST STATE=heating)
gcode:
    {% set state = params.STATE|default("idle")|lower %}
    {action_call_remote_method("POST",
                               uri="/server/lumen/test_event",
                               params={"event": state})}
    RESPOND MSG="LUMEN testing {state} state"

[gcode_macro LUMEN_SET]
description: Override a group's effect (e.g., LUMEN_SET GROUP=left EFFECT=pulse COLOR=red DURATION=10)
gcode:
    {% set group = params.GROUP|default("")|lower %}
    {% set effect = params.EFFECT|default("solid")|lower %}
    {% set color = params.COLOR|default("white")|lower %}
    {% set duration = params.DURATION|default(0)|float %}

    {% if group == "" %}
        RESPOND MSG="Error: GROUP parameter required"
    {% else %}
        {action_call_remote_method("POST",
                                   uri="/server/lumen/set_group",
                                   params={"group": group,
                                          "effect": effect,
                                          "color": color,
                                          "duration": duration})}
        {% if duration > 0 %}
            RESPOND MSG="LUMEN: {group} set to {effect} {color} for {duration}s"
        {% else %}
            RESPOND MSG="LUMEN: {group} set to {effect} {color}"
        {% endif %}
    {% endif %}

# Example usage in your macros:
#
# [gcode_macro PRINT_START]
# gcode:
#     # ... your existing PRINT_START code ...
#     LUMEN_SET GROUP=chamber EFFECT=solid COLOR=white  # Set chamber to bright white for printing
#     # ... rest of your code ...
#
# [gcode_macro PRINT_END]
# gcode:
#     # ... your existing PRINT_END code ...
#     LUMEN_RELOAD  # Reload config to return to normal state cycle
#     # ... rest of your code ...
